<!DOCTYPE html>
<html>

<head>
<title>Trove Words</title>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>



<body>
    
    <header>

</header>
<p> Reference: view-source:http://deco1800.uqcloud.net/examples/basicTroveSearch.html?#</p>

	<form action ="#" id="searchTrove">
		<h3>Choose a Topic</h3>
		<input id="searchTerm" type="text" />
<!-- 		<h3>Number Of Words</h3> -->
<!-- 		<input id="numberSelect" type="number" /> -->
		
		<button type="submit" id="searchbtn">Enter</button>
	</form>
	<br>
	<div id="searchTitle">
	</div>

	
	
	<section>
		<div id="wordsearch">
		
		<table cellspacing=0>
	
			<tr>
				<td id="tr_1">a</td>
				<td id="tr_2">b</td>
				<td id="tr_3">c</td>
				<td id="tr_4">d</td>
				<td id="tr_5">e</td>
				<td id="tr_6">f</td>
				<td id="tr_7">g</td>
				<td id="tr_8">h</td>
				<td id="tr_9">i</td>
				<td id="tr_10">j</td>
			</tr>
			<tr>
				<td id="tr_11">a</td>
				<td id="tr_12">b</td>
				<td id="tr_13">c</td>
				<td id="tr_14">d</td>
				<td id="tr_15">e</td>
				<td id="tr_16">f</td>
				<td id="tr_17">g</td>
				<td id="tr_18">h</td>
				<td id="tr_19">i</td>
				<td id="tr_20">j</td>
			</tr>
			<tr>
				<td id="tr_21">a</td>
				<td id="tr_22">b</td>
				<td id="tr_23">c</td>
				<td id="tr_24">d</td>
				<td id="tr_25">e</td>
				<td id="tr_26">f</td>
				<td id="tr_27">g</td>
				<td id="tr_28">h</td>
				<td id="tr_29">i</td>
				<td id="tr_30">j</td>
			</tr>
			<tr>
				<td id="tr_31">a</td>
				<td id="tr_32">b</td>
				<td id="tr_33">c</td>
				<td id="tr_34">d</td>
				<td id="tr_35">e</td>
				<td id="tr_36">f</td>
				<td id="tr_37">g</td>
				<td id="tr_38">h</td>
				<td id="tr_39">i</td>
				<td id="tr_40">j</td>
			</tr>
			<tr>
				<td id="tr_41">a</td>
				<td id="tr_42">b</td>
				<td id="tr_43">c</td>
				<td id="tr_44">d</td>
				<td id="tr_45">e</td>
				<td id="tr_46">f</td>
				<td id="tr_47">g</td>
				<td id="tr_48">h</td>
				<td id="tr_49">i</td>
				<td id="tr_50">j</td>
			</tr>
			<tr>
				<td id="tr_51">a</td>
				<td id="tr_52">b</td>
				<td id="tr_53">c</td>
				<td id="tr_54">d</td>
				<td id="tr_55">e</td>
				<td id="tr_56">f</td>
				<td id="tr_57">g</td>
				<td id="tr_58">h</td>
				<td id="tr_59">i</td>
				<td id="tr_60">j</td>
			</tr>
			<tr>
				<td id="tr_61">a</td>
				<td id="tr_62">b</td>
				<td id="tr_63">c</td>
				<td id="tr_64">d</td>
				<td id="tr_65">e</td>
				<td id="tr_66">f</td>
				<td id="tr_67">g</td>
				<td id="tr_68">h</td>
				<td id="tr_69">i</td>
				<td id="tr_70">j</td>
			</tr>
			<tr>
				<td id="tr_71">a</td>
				<td id="tr_72">b</td>
				<td id="tr_73">c</td>
				<td id="tr_74">d</td>
				<td id="tr_75">e</td>
				<td id="tr_76">f</td>
				<td id="tr_77">g</td>
				<td id="tr_78">h</td>
				<td id="tr_79">i</td>
				<td id="tr_80">j</td>
			</tr>
			<tr>
				<td id="tr_81">a</td>
				<td id="tr_82">b</td>
				<td id="tr_83">c</td>
				<td id="tr_84">d</td>
				<td id="tr_85">e</td>
				<td id="tr_86">f</td>
				<td id="tr_87">g</td>
				<td id="tr_88">h</td>
				<td id="tr_89">i</td>
				<td id="tr_90">j</td>
			</tr>
			<tr>
				<td id="tr_91">a</td>
				<td id="tr_92">b</td>
				<td id="tr_93">c</td>
				<td id="tr_94">d</td>
				<td id="tr_95">e</td>
				<td id="tr_96">f</td>
				<td id="tr_97">g</td>
				<td id="tr_98">h</td>
				<td id="tr_99">i</td>
				<td id="tr_100">j</td>
			</tr>
			

		</table>	
	
	</div>
	
		<div id="articleView"></div>
		
	</section>
	
	<div id="wordlist">
		
	</div>

	<script type="text/javascript">
		var apiKey = "1nnn6t7d804o8dt1";
		$(document).ready(function(){
		$("form#searchTrove").submit();

		$("form#searchTrove").submit(function(){

			var searchTerm= $("#searchTerm").val();
			var searchZone = "newspaper";
			var date = " date:[1980 TO 2016]";
			var numberOfWords= $("#numberSelect").val();
			$("#searchTitle").append(searchTerm);
			//Builds URL using above variables, changing n= in final term changes number of articles returned
			var url = "http://api.trove.nla.gov.au/result?key=" + apiKey + "&encoding=json&zone=" + searchZone + 
				    "&sortby=relevance" + "&q=" + searchTerm + date + "&s=0&n=1&include=articletext,pdf&encoding=json&callback=?";

			console.log(url);
			
			$.getJSON(url, function(data) {
				//Empties output 
				$("#output").empty();
				//Gets each article returned and does following function on it
				$.each(data.response.zone[0].records.article, function(index,value){
					//Puts data from article in variable
					var articleData = value.articleText;
					//$("#articleView").append(articleData);
					console.log(articleData);
					
					
					
					
					//Removes html tags from data using RegEx
					function removeTags(words){
					
						var span_tag = /<span>/g;
						var p_tag = /<p>/g;
						var end_p_tag= /<\/p>/g;
						var end_span_tag= /<\/span>/g;
						var str = words.toString();
						var get_rid_tags = str.replace(span_tag,"").replace(p_tag,"").replace(end_p_tag,"").replace(end_span_tag,"").replace(/[^\w\s]|_/g, "").replace(/\s+/g, " ").replace(/^\d+$/g,"");
						
						
						var tagless = get_rid_tags.split(' ');
						
						
						return tagless;
						
						
					};
					//Removes tags and puts non-filtered words into an array
					var articleArray = removeTags(articleData);
					console.log(articleArray);
					

					//If length of array, ie number of words, is between desired amount, run code
					if (articleArray.length>25&&articleArray.length<10000){
					
						var filter_words= 'a,A,it,It,was,Was,the,it,will,what,from,only,their,with,is,we,all,a,an,by,this,those,that,could,to,you,me,he,she,they,we,how,it,i,are,to,for,of,in,or,out,on,at,so,be,The,around,and,said,have,that,when,were,new,Ill,to,<span>,<p><span>,</p></span>,, ,.,(,),`,~,!,@,#,$,%,^,&,*,-,_,=,+,{,[,],}.|,\,:,;,<,>,?,",/,/,-,1,2,3,4,5,6,7,8,9,10,';
						var filter = filter_words.split(',');	
						var dict=[];
						
					
						
						for(var i=0;i<articleArray.length;i++){
							//For elements in array, if each is not in the filtered word list, push to dict array
							if (filter.indexOf(articleArray[i])==-1&&articleArray[i].length>4&&articleArray[i].length<7&&($.inArray(articleArray[i],dict)==-1)){
                                
								dict.push(articleArray[i]);
							
							};
						}; 
                        
                        
                        
						
						
						var finalWordList = [];
						
						for(var i=0;i<10;i++){
							
							//Randomiser is a random number between 1 and the length of the dict
							var randomiser = Math.floor(Math.random() * dict.length)
							//Picks a number according to randomiser
							var randomElement = dict[randomiser];
							//Adds random element to final word list in lower case
							finalWordList.push(' ' + randomElement.toLowerCase());
							
							
						};
						//Outputs to output div in paragraph format
						$("#wordlist").append("<h3>Word List</h3> <p>" + finalWordList + "</p><hr/>");
						
						
						function getLetters(word){
							var letters = []
							//For every element in a word, returns an array with letters. i=1 due to previously added space
							for(var i=1;i<word.length;i++){
							letters.push(word[i]);
						
							};
							return letters;
						
						};
						
						
                        var usedPositions = [];
                        var coordinates = {};
                        
                        
                    
                        function addHorizontal(lettersArray){
                            
                            var possible_units = {5:'6',6:'5',7:'4',8:'3',9:'2'};
                            var units = (Math.floor(Math.random() * possible_units[lettersArray.length])+1);
                            var tens = (Math.floor(Math.random()*9)+1)*10
                            var random_place = (tens+units);             
                            var checker = [];

                            for(var i=0;i<lettersArray.length;i++){

                                if($.inArray(random_place+i,usedPositions)==-1||coordinates[random_place+i]==lettersArray[i]){
                                    checker.push('1');

                                   }else{

                                       addHorizontal(lettersArray);
                                       return;
                                   };
                        };
                   
        
                                if(checker.length = lettersArray.length){
                                
                                    for(var i=0;i<lettersArray.length;i++){
                                                //deletes whats in table and appends 
                                                $("#tr_" +(random_place+i)).empty();
                                                $("#tr_"+(random_place+i)).append(lettersArray[i]);

                                                //adds that co-ordinate to used postions
                                                usedPositions.push(random_place+i);
                                                coordinates[random_place+i]=lettersArray[i];
                                                console.log("success");

										
                                };
                    };
        
    
                      };
        
                        function addVertical(lettersArray){
                            var checker2 = [];
            var range = 100-((lettersArray.length)*10);
            var random_place2 = Math.floor((Math.random() * range)+1); 
            console.log(random_place2);
           
            var space2 = (Math.floor((100-random_place2)/10));
            console.log(space2);
            
            
            
            
            if(lettersArray.length<=space2){
                        
                
                for(var i=0;i<lettersArray.length;i++){
                    
                    if($.inArray(random_place2+(10*i),usedPositions)==-1||coordinates[random_place2+(10*i)]==lettersArray[i]){
                        
                      checker2.push('1');
                    }else{
                        console.log('yes');
                        addVertical(lettersArray);
                        return;
                        
                    };
                };
             if(checker2.length = lettersArray.length){
                                
								for(var i=0;i<lettersArray.length;i++){
											//deletes whats in table and appends 
											$("#tr_" +(random_place2+(10*i))).empty();
											$("#tr_"+(random_place2+(10*i))).append(lettersArray[i]);
											
											//adds that co-ordinate to used postions
                                            usedPositions.push(random_place2+(10*i));
                                            coordinates[random_place2+(10*i)]=lettersArray[i];
											console.log("success");
										
										
                                };
                    };
                
                
                
                
                
        
                
            }else{
                
                addVertical(lettersArray);
                return;
            };
        
            
            
            
        };
                       
						
						
						
						
					
						//For every element in final word list, add word to wordsearch via addWord
						 for(var i=0;i<finalWordList.length;i++){
                             //var selector = Math.floor((Math.random() * 10) + 1);
						
				            if(i==0||i==2||i==4||i==6||i==8){
                                addHorizontal(getLetters(finalWordList[i]));
                    
                            }else{
                                addVertical(getLetters(finalWordList[i]));
                };		
                         };
						
						
						
						
						
						
						
						
						
						
				
						
						
						
						
						console.log(finalWordList);
						};
                var alphabet = "abcdefghijklmnopqrstuvwxyz";
					for(var i=1;i<101;i++){
            if($.inArray(i,usedPositions)==-1){
               
               $("#tr_" +i).empty();
               $("#tr_" +i).append(alphabet.charAt(Math.floor(Math.random() * alphabet.length)));
               
               };
        };
						
					});
				
					
				});
				
				});
				});
				
				
				
				
				
				
				



			






		
	</script>

</body>

<footer>

</footer>

</html>